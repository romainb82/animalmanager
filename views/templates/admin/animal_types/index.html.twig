{% extends '@PrestaShop/Admin/layout.html.twig' %}

{% block content %}
<div class="card">
  <div class="card-header d-flex justify-content-between align-items-center">
    <h3 class="card-header-title">
      {{ 'Gestion des types d\'animaux'|trans({}, 'Modules.Animalmanager.Admin') }}
    </h3>
    <a href="{{ path('admin_animal_type_add') }}" class="btn btn-primary">
      {{ 'Ajouter un type'|trans({}, 'Modules.Animalmanager.Admin') }}
    </a>
  </div>
  <div class="card-body">
    <form method="post" action="" id="bulk-delete-form">
      <table class="table">
        <thead>
          <tr>
            <th><input type="checkbox" onclick="toggleCheckboxes(this)"></th>
            {% for column in grid.columns %}
              <th>{{ column.name }}</th>
            {% endfor %}
            <th>{{ 'Actions'|trans({}, 'Admin.Global') }}</th>
          </tr>
        </thead>
        <tbody>
          {% for record in grid.data.records %}
            <tr class="clickable-row">
              <td>
                <input type="checkbox" name="type_ids[]" value="{{ record.id_animal_type }}">
              </td>
              {% for column in grid.columns %}
                <td>
                  {{ attribute(record, column.options.field) }}
                </td>
              {% endfor %}
              <td>
                <a href="{{ path('admin_animal_type_edit', { id: record.id_animal_type }) }}">‚úèÔ∏è</a>
                <a href="{{ path('admin_animal_type_delete', { id: record.id_animal_type }) }}"
                   onclick="return confirm('Supprimer ce type ?');">üóëÔ∏è</a>
              </td>
            </tr>
          {% else %}
            <tr>
              <td colspan="{{ grid.columns|length + 2 }}" class="text-center">
                {{ 'Aucun type trouv√©'|trans({}, 'Modules.Animalmanager.Admin') }}
              </td>
            </tr>
          {% endfor %}
        </tbody>
      </table>

      <input type="hidden" name="_token" value="{{ csrf_token('animal_type_bulk_delete') }}">

    </form>
  </div>
</div>

<script>
function toggleCheckboxes(source) {
  const checkboxes = document.querySelectorAll('input[name="type_ids[]"]');
  checkboxes.forEach(cb => cb.checked = source.checked);
}

document.addEventListener('DOMContentLoaded', function () {
  document.querySelectorAll('tr.clickable-row').forEach(function (row) {
    row.addEventListener('click', function (e) {
      if (e.target.closest('a, button, input, form')) return;
      const checkbox = this.querySelector('input[type="checkbox"]');
      if (checkbox) checkbox.checked = !checkbox.checked;
    });
  });
});
</script>
{% endblock %}
